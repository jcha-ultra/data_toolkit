
```{r libs}

library(caret)
library(dataPreparation)
library(magrittr)
library(dplyr)

```

```{r ingest}

path <- "~/repos/toolkit/datasets/titanic/train.csv"
training_data <- read.csv(path)

```

## Introduction

This is a learning project for me to get acquainted with the basics of machine learning. As such, it is likely to contain mistakes, so please be aware of that if you intende to use this as a reference.

## Examination

Check the data to see if any data quality red flags stick out. The source of the data is from the Titanic ML competition in Kaggle: https://www.kaggle.com/c/titanic/data

```{r examination}

summary(training_data)
pointblank::scan_data(training_data)

```

Examination Notes:
* encoding required: `Ticket`, `Cabin`, `Embarked`
* some dimensional reduction is likely warranted; some of the character columns may not be predictive
* the only clear correlation is between `Pclass` and `Fare`, which are negatively correlated; they're also mildly correlated with `Survived`, the target variable, as expected
* `PassengerId` is just a unique identifier added by Kaggle can be dropped; `Name` is also unique and won't add value to prediction
* only missing data appears to be in `Age` and `Cabin`
* `Cabin` is super sparse and might not be that useful; consider dropping
* `Cabin` also has some values that are concatenations of multiple cabin numbers; may consider tokenizing these into different columns, or maybe converting to a "num_cabins" variable, but the column is so sparse it might not be worth it
* `Cabin` _also_ has some single-letter values that may need to be cleaned
* `Ticket` has high cardinality, with apparently arbitrary values and might not add much to prediction; consider dropping

## Cleaning

Clean out parts of the data that may cause problems for the model.

```{r cleaning}

training_data_cleaned <- subset(training_data, select = -c(PassengerId, Name))

```

## Encoding

Encode categorical variables into numerical ones so that they're usable by models. I decided to use target encoding due to its simplicity, so that I can understand what's happening.

```{r}

# encode Sex column
training_data_encoded <- training_data_cleaned
training_data_encoded$Sex <- purrr::map_int(training_data_cleaned$Sex, function(x) if(x == "male") 1L else 0L)

# target encoding
encoded_cols <- c("Ticket", "Cabin", "Embarked")
encoding <- build_target_encoding(training_data_encoded, cols_to_encode = encoded_cols, target_col = "Survived")
training_data_encoded <- target_encode(training_data_encoded, target_encoding = encoding) %>% select(!all_of(encoded_cols))

```

I am rather skeptical as to how much `Ticket` and `Cabin` really contribute to the prediction, but perhaps we can do an analysis with and without them.